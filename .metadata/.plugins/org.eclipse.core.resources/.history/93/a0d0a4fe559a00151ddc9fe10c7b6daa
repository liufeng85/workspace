'''
@author: Administrator
'''
import pymssql
#cp936


class MSSQL:
    
    def __init__(self,db_conf):
        self.host = db_conf["host"]
        self.user = db_conf["user"]
        self.pwd = db_conf["pwd"]
        self.db = db_conf["db"]

    def __GetConnect(self):
        if not self.db:
            raise(NameError,"no such database")
        self.conn = pymssql.connect(host=self.host,user=self.user,password=self.pwd,database=self.db,charset='utf8')
        cur = self.conn.cursor()
        if not cur:
            raise(NameError,"fail to connect to database")
        else:
            return cur

    def ExecQuery(self,sql):
        cur = self.__GetConnect()
        cur.execute(sql)
        resList = cur.fetchall()

        self.conn.close()
        return resList

    def ExecNonQuery(self,sql):
        cur = self.__GetConnect()
        cur.execute(sql)
        self.conn.commit()
        self.conn.close()
    
    def str2bin(self,strText):
        b = bytes((ord(i) for i in strText))
        return b

def getCode(strText,codec):
    b = bytes((ord(i) for i in strText))  
    return b.decode(codec,'ignore')